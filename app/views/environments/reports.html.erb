<%#= button_to 'GRAPHS' %>
<%#= pie_chart User.group(:email).count %>
<%= form_with(url: '/reports', method: "get") do |f| %>
<table>
    <thead>
        <tr>
            <th>Start Date</th>
            <th>End Date</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><%= f.date_field :start_date, class: 'datepicker', value: :"#{params[:start_date]}" %>
                <%#= f.input :start_date, as: :date_picker, :input_html => { :value => "#{params[:start_date]}"} %>
            </td>
            <td><%= f.date_field :end_date, class: 'datepicker', value: :"#{params[:end_date]}" %><%#= select_tag :default_environ, options_for_select(@environ_list) %> <%#= f.select :default_environ, @environ_list, selected: :"#{current_user.default_environ}" %></td>
            <td><%= f.submit :submit %></td>
        </tr>
    </tbody>
</table>

<% end -%>
<div style="display: flex; justify-content: center;">
    <div>
        <h3>Run status of Test Suite</h3>
        <%= pie_chart @sche_status,id: "schedulerStatus", donut: true, library: {backgroundColor: "#eee"} %>
    </div>
    <div>
        <h3>Status of test Suite</h3>
        <%= pie_chart @suite_status,id: "suiteStatus", donut: true, library: {backgroundColor: "#eee"} %>
    </div>
</div>



<h1 style="text-align: center;">Reports for <%= @e %></h1>
<div class="modal fade" id="cases" title="My modal">
    <div class="modal-header">

    </div>
    <div class="modal-body">
        <button aria-hidden="true" class="close" id="health-modal-close" type="button">Ã—</button>
        <div id="health-modal">

        </div>
    </div>
    <div class="modal-footer">
    </div>
</div>
<%#= column_chart User.group_by(:created_at).count %>

<form action="/run_suites" method="post">
    <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
    <table id="suite-table-dude" style="width:100%">
        <thead>
            <tr>
                <th>Schedule Id</th>
                <th>TestSuite Name</th>
                <th>Status</th>
                <th>Schedule Date</th>
                <th></th>

            </tr>
        </thead>

        <tbody>
            <% if @schedule.present? %>
            <% @schedule.each do |s| %>
            <tr>
                <td><%= s.id %></td>
                <% hidden_field_tag 'id', '#{s.id}' %>
                <td><%= TestSuite.find(s.test_suite_id).name %></td>
                <td><%= s.status %></td>
                <td><%= s.scheduled_date%></td>
                <td class="button-cell"><%#= link_to "List all the reports", {controller: "test_suites", action: "schedule_cases", id: s.id }, "data-toggle" => "modal", "data-target" => "#cases", class: "btn btn-default btn-sm", remote: true %>
                    <%= link_to "List All Reports",list_all_reports_path(id: s.id), target: :_blank %>
                </td>
            </tr>
            <% end %>
            <% end %>
        </tbody>
    </table>

</form>

<style>
    table,
    th,
    td {
        border: 1px solid black;
        border-collapse: collapse;
    }
</style>

<script>
    $("#suite-table-dude").dataTable({
        "iDisplayLength": 50
    });

    $(document).ready(function() {
        var chartRunStatus = Chartkick.charts["schedulerStatus"]
        chartRunStatus.options.library.onClick = function(ev, item) {
            if (item == null || item.length == 0) return;

            var curIndex = item[0]._index;

            var curItem = chartRunStatus.dataSource[curIndex];
            if (curItem != null) {
                console.log(curItem[0]);
            }
        }
        chartRunStatus.redraw();

        var chartModeStatus = Chartkick.charts["suiteStatus"]
        chartModeStatus.options.library.onClick = function(ev, item) {
            if (item == null || item.length == 0) return;

            var curIndex = item[0]._index;

            var curItem = chartModeStatus.dataSource[curIndex];
            if (curItem != null) {
                console.log(curItem[0]);
            }
        }
        chartModeStatus.redraw();
    })
</script>